<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤šè³‡æ–™è¡¨ç®¡ç†ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-gray-100">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">ğŸ“ è³‡æ–™è¡¨ç®¡ç†</h1>

    <div class="mb-4 flex flex-wrap gap-2 items-center">
      <input id="newTableName" type="text" placeholder="è¼¸å…¥æ–°è³‡æ–™è¡¨åç¨±" class="border p-2 w-64">
      <button onclick="createTable()" class="bg-blue-500 text-white px-4 py-2 rounded">å»ºç«‹è³‡æ–™è¡¨</button>
    </div>

    <div class="bg-white rounded shadow p-4">
      <h2 class="text-xl font-bold mb-2">ç¾æœ‰è³‡æ–™è¡¨</h2>
      <div id="tableList" class="flex flex-wrap gap-2"></div>
    </div>

    <div id="formSection" class="hidden mt-6">
      <h2 class="text-xl font-bold mb-2">ğŸ“„ <span id="currentTableName"></span></h2>
      <form id="dataForm" class="flex flex-wrap gap-2 bg-white p-4 rounded shadow mb-4">
        <input type="date" name="æ—¥æœŸ" class="border p-2 w-32" required>
        <select name="åç¨±" class="border p-2 w-32" required>
  <option value="">è«‹é¸æ“‡</option>
  <option value="ç™¼çµ±">ç™¼çµ±</option>
  <option value="åˆè³€">åˆè³€</option>
  <option value="é ‚æ—º">é ‚æ—º</option>
  <option value="ç¶­æ³°">ç¶­æ³°</option>
  <option value="é‡‘å·">é‡‘å·</option>
  <option value="ç¿Šç™¼">ç¿Šç™¼</option>
  <option value="å¯¬è±ª">å¯¬è±ª</option>
  <option value="è€æ–¯">è€æ–¯</option>
  <option value="æ¾æ…¶">æ¾æ…¶</option>
  <option value="æ¾é”">æ¾é”</option>
</select>
        <input type="text" name="ä»¶æ•¸" placeholder="ä»¶æ•¸" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" name="ç¸½é‡" placeholder="ç¸½é‡" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" name="æ¿ç¨®" placeholder="æ¿ç¨®" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" name="é•·" placeholder="é•·(cm)" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" name="å¯¬" placeholder="å¯¬(cm)" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" name="é«˜" placeholder="é«˜(cm)" class="border p-2 w-24" pattern="\d*" inputmode="numeric">
        <input type="text" id="cbmDisplay" placeholder="CBM" class="border p-2 w-32 bg-gray-100" readonly>
        <input type="text" name="å‚™è¨»" placeholder="å‚™è¨»" class="border p-2 w-64">
        <button id="submitBtn" type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">æ–°å¢è³‡æ–™</button>
      </form>

      <h3 class="text-lg font-semibold mb-2">ğŸ“Š å·²å»ºç«‹è³‡æ–™</h3>
      <table class="w-full table-auto bg-white shadow rounded overflow-hidden">
        <thead class="bg-gray-200">
          <tr id="tableHead"></tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
      <button onclick="exportExcel()" class="mt-4 bg-green-500 text-white p-2 rounded">åŒ¯å‡ºæˆ Excel</button>
    </div>
  </div>

  <script>
    const fields = ["æ—¥æœŸ", "åç¨±", "ä»¶æ•¸", "ç¸½é‡", "æ¿ç¨®", "é•·", "å¯¬", "é«˜", "CBM", "å‚™è¨»"];
    let currentTable = '';
    let editIndex = -1;

    function loadTables() {
      const keys = Object.keys(localStorage).filter(k => k.startsWith('table_'));
      const list = document.getElementById('tableList');
      list.innerHTML = '';
      keys.forEach(k => {
        const name = k.replace('table_', '');
        const card = document.createElement('div');
        card.className = 'border rounded p-2 flex items-center gap-4 bg-gray-50 shadow-sm';
        card.innerHTML = `
          <span class="font-medium">${name}</span>
          <button onclick="openTable('${name}')" class="text-blue-600">æ‰“é–‹</button>
          <button onclick="deleteTable('${name}')" class="text-red-600">åˆªé™¤</button>
        `;
        list.appendChild(card);
      });
    }

    function createTable() {
      const name = document.getElementById('newTableName').value.trim();
      if (!name) return alert('è«‹è¼¸å…¥åç¨±');
      const key = `table_${name}`;
      if (localStorage.getItem(key)) return alert('è³‡æ–™è¡¨å·²å­˜åœ¨');
      localStorage.setItem(key, '[]');
      document.getElementById('newTableName').value = '';
      loadTables();
    }

    function deleteTable(name) {
      if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${name}ã€è³‡æ–™è¡¨ï¼Ÿ`)) {
        localStorage.removeItem(`table_${name}`);
        loadTables();
        if (currentTable === name) {
          document.getElementById('formSection').classList.add('hidden');
        }
      }
    }

    function openTable(name) {
      currentTable = name;
      editIndex = -1;
      document.getElementById('currentTableName').innerText = name;
      document.getElementById('formSection').classList.remove('hidden');
      document.getElementById('submitBtn').innerText = 'æ–°å¢è³‡æ–™';
      renderTable();
    }

    function calculateCBM() {
      const l = parseFloat(document.querySelector('[name="é•·"]').value) || 0;
      const w = parseFloat(document.querySelector('[name="å¯¬"]').value) || 0;
      const h = parseFloat(document.querySelector('[name="é«˜"]').value) || 0;
      const cbm = (l * w * h / 1000000).toFixed(6);
      document.getElementById('cbmDisplay').value = cbm > 0 ? cbm : '';
      return cbm > 0 ? cbm : '';
    }

    document.querySelector('[name="é•·"]').addEventListener('input', calculateCBM);
    document.querySelector('[name="å¯¬"]').addEventListener('input', calculateCBM);
    document.querySelector('[name="é«˜"]').addEventListener('input', calculateCBM);

    document.getElementById('dataForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const obj = {};
      formData.forEach((v, k) => obj[k] = v);
      obj['CBM'] = calculateCBM();
      const key = `table_${currentTable}`;
      let list = JSON.parse(localStorage.getItem(key) || '[]');

      if (editIndex === -1) {
        list.push(obj);
      } else {
        list[editIndex] = obj;
        editIndex = -1;
        document.getElementById('submitBtn').innerText = 'æ–°å¢è³‡æ–™';
      }
      localStorage.setItem(key, JSON.stringify(list));
      e.target.reset();
      document.getElementById('cbmDisplay').value = '';
      renderTable();
    });

    function renderTable() {
      const data = JSON.parse(localStorage.getItem(`table_${currentTable}`) || '[]');
      const headRow = document.getElementById('tableHead');
      const body = document.getElementById('dataTable');
      headRow.innerHTML = '';
      fields.concat(["æ“ä½œ"]).forEach(f => {
        const th = document.createElement('th');
        th.className = "border p-2";
        th.innerText = f;
        headRow.appendChild(th);
      });
      body.innerHTML = '';
      data.forEach((row, i) => {
        const tr = document.createElement('tr');
        fields.forEach(f => {
          const td = document.createElement('td');
          td.className = "border p-2 text-sm";
          td.innerText = row[f] || '';
          tr.appendChild(td);
        });
        const td = document.createElement('td');
        td.className = "border p-2";
        td.innerHTML = `
          <button onclick="editRow(${i})" class="text-blue-500 mr-2">ä¿®æ”¹</button>
          <button onclick="deleteRow(${i})" class="text-red-500">åˆªé™¤</button>`;
        tr.appendChild(td);
        body.appendChild(tr);
      });
    }

    function editRow(i) {
      const data = JSON.parse(localStorage.getItem(`table_${currentTable}`) || '[]');
      const row = data[i];
      const form = document.getElementById('dataForm');
      fields.forEach(f => {
        if (f === 'CBM') return;
        form.elements[f].value = row[f] || '';
      });
      document.getElementById('cbmDisplay').value = row['CBM'] || '';
      editIndex = i;
      document.getElementById('submitBtn').innerText = 'æ›´æ–°è³‡æ–™';
    }

    function deleteRow(i) {
      const key = `table_${currentTable}`;
      const list = JSON.parse(localStorage.getItem(key) || '[]');
      list.splice(i, 1);
      localStorage.setItem(key, JSON.stringify(list));
      renderTable();
    }

    function exportExcel() {
      const data = JSON.parse(localStorage.getItem(`table_${currentTable}`) || '[]');
      const worksheet = XLSX.utils.json_to_sheet(data);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, currentTable);
      XLSX.writeFile(workbook, `${currentTable}.xlsx`);
    }

    loadTables();
  </script>
</body>
</html>
